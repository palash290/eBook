<!-- <section class="ct_px_40 ct_pt_80 ct_pb_100  ct_mb_40">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="ct_user_chat_parent_div">
                    <div class="d-flex align-items justify-content-between gap-3 flex-wrap">
                        <div class="ct_chat_message_user">
                            <img src="assets/img/user2.jpg" alt="">
                            <div>
                                <h5 class="ct_fs_20 ct_fw_600 mb-0">Sarah Wilson</h5>
                                <p class="ct_fs_18 ct_text_636363 ct_fw_500 mb-0">Fiction Writer</p>
                            </div>
                        </div>
                    </div>

                    <div class="ct_user_body_parent_div ct_mt_60">
                        <div class="ct_user_chat_left">
                            <p>Hello ,I hope you're doing well. Could you share more about the book’s theme and
                                style? </p>
                            <h6>10:30 AM</h6>
                        </div>
                        <div class="ct_user_chat_right">
                            <p>Yes, my book is about personal development and motivation. I want it to have a
                                professional yet engaging tone, something like "Atomic Habits" or "The 5 AM Club.
                            </p>
                            <h6>10:30 AM</h6>
                        </div>
                        <div class="ct_user_chat_left">
                            <p>Do you have any specific preferences for the writing style and design?
                            </p>
                            <h6>10:30 AM</h6>
                        </div>

                        <div class="ct_user_chat_right">
                            <p>I’m not sure yet. I just want it to be easy to read and visually appealing. Can you
                                suggest something? </p>
                            <h6>10:30 AM</h6>
                        </div>
                        <div class="ct_user_chat_left">
                            <p>Do you have any specific preferences for the writing style and design?
                            </p>
                            <h6>10:30 AM</h6>
                        </div>

                        <div class="ct_user_chat_right">
                            <p>I’m not sure yet. I just want it to be easy to read and visually appealing. Can you
                                suggest something? </p>
                            <h6>10:30 AM</h6>
                        </div>
                        <div class="ct_user_chat_left">
                            <p>Do you have any specific preferences for the writing style and design?
                            </p>
                            <h6>10:30 AM</h6>
                        </div>

                        <div class="ct_user_chat_right">
                            <p>I’m not sure yet. I just want it to be easy to read and visually appealing. Can you
                                suggest something? </p>
                            <h6>10:30 AM</h6>
                        </div>
                        <div class="ct_user_chat_left">
                            <p>Do you have any specific preferences for the writing style and design?
                            </p>
                            <h6>10:30 AM</h6>
                        </div>

                        <div class="ct_user_chat_right">
                            <p>I’m not sure yet. I just want it to be easy to read and visually appealing. Can you
                                suggest something? </p>
                            <h6>10:30 AM</h6>
                        </div>
                        <div class="ct_user_chat_left">
                            <p>Do you have any specific preferences for the writing style and design?
                            </p>
                            <h6>10:30 AM</h6>
                        </div>

                        <div class="ct_user_chat_right">
                            <p>I’m not sure yet. I just want it to be easy to read and visually appealing. Can you
                                suggest something? </p>
                            <h6>10:30 AM</h6>
                        </div>
                        <div class="ct_user_chat_left">
                            <p>Do you have any specific preferences for the writing style and design?
                            </p>
                            <h6>10:30 AM</h6>
                        </div>

                        <div class="ct_user_chat_right">
                            <p>I’m not sure yet. I just want it to be easy to read and visually appealing. Can you
                                suggest something? </p>
                            <h6>10:30 AM</h6>
                        </div>
                        <div class="ct_user_chat_left">
                            <p>Do you have any specific preferences for the writing style and design?
                            </p>
                            <h6>10:30 AM</h6>
                        </div>

                        <div class="ct_user_chat_right">
                            <p>I’m not sure yet. I just want it to be easy to read and visually appealing. Can you
                                suggest something? </p>
                            <h6>10:30 AM</h6>
                        </div>
                        <div class="ct_user_chat_left">
                            <p>Do you have any specific preferences for the writing style and design?
                            </p>
                            <h6>10:30 AM</h6>
                        </div>

                        <div class="ct_user_chat_right">
                            <p>I’m not sure yet. I just want it to be easy to read and visually appealing. Can you
                                suggest something? </p>
                            <h6>10:30 AM</h6>
                        </div>
                        <div class="ct_user_chat_left">
                            <p>Do you have any specific preferences for the writing style and design?
                            </p>
                            <h6>10:30 AM</h6>
                        </div>

                        <div class="ct_user_chat_right">
                            <p>I’m not sure yet. I just want it to be easy to read and visually appealing. Can you
                                suggest something? </p>
                            <h6>10:30 AM</h6>
                        </div>
                    </div>


                    <div *ngIf="previewFiles.length > 0" class="preview-container">
                        <div *ngFor="let file of previewFiles" class="preview">
                            <img *ngIf="file.type.startsWith('image/')" [src]="file.url" alt="File preview" />
                            <i (click)="removeFile(file)" class="fa fa-minus-circle remove" aria-hidden="true"></i>
                        </div>
                    </div>
                    <div class="ct_bottom_chat_footer">
                        <div class="ct_upload_icons">
                            <label for="ct_chat_image_upload">
                                <input type="file" class="d-none" id="ct_chat_image_upload"
                                    (change)="onFileChange($event)" multiple>
                                <div class="ct_chat_image_div">
                                    <svg width="30" height="31" viewBox="0 0 44 45" fill="none"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M39.1875 6H4.8125C4.26549 6 3.74089 6.2173 3.35409 6.60409C2.9673 6.99089 2.75 7.51549 2.75 8.0625V36.9375C2.75 37.4845 2.9673 38.0091 3.35409 38.3959C3.74089 38.7827 4.26549 39 4.8125 39H39.1875C39.7345 39 40.2591 38.7827 40.6459 38.3959C41.0327 38.0091 41.25 37.4845 41.25 36.9375V8.0625C41.25 7.51549 41.0327 6.99089 40.6459 6.60409C40.2591 6.2173 39.7345 6 39.1875 6ZM28.4986 11.5172C29.343 11.4398 30.1908 11.6246 30.9265 12.0463C31.6621 12.468 32.25 13.1062 32.6099 13.874C32.9699 14.6418 33.0844 15.5019 32.938 16.3371C32.7917 17.1724 32.3914 17.9422 31.7918 18.5418C31.1922 19.1414 30.4224 19.5417 29.5871 19.688C28.7519 19.8344 27.8918 19.7199 27.124 19.3599C26.3562 19 25.718 18.4121 25.2963 17.6765C24.8746 16.9408 24.6898 16.093 24.7672 15.2486C24.8551 14.2886 25.2765 13.3898 25.9582 12.7082C26.6398 12.0265 27.5386 11.6051 28.4986 11.5172ZM6.53125 36.25C6.25775 36.25 5.99544 36.1414 5.80205 35.948C5.60865 35.7546 5.5 35.4923 5.5 35.2188V27.688L16.555 17.8594L24.8866 26.1738L14.813 36.25H6.53125ZM38.5 35.2188C38.5 35.4923 38.3913 35.7546 38.198 35.948C38.0046 36.1414 37.7423 36.25 37.4688 36.25H18.7026L31.5528 23.3998L38.5 29.1894V35.2188Z"
                                            fill="#6B7280" />
                                    </svg>
                                </div>
                            </label>
                            <label for="ct_chat_file_upload">
                                <input type="file" class="d-none" id="ct_chat_file_upload">
                                <div class="ct_chat_image_div">
                                    <svg width="30" height="31" viewBox="0 0 44 45" fill="none"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M28.875 24.332C28.875 23.9674 28.7301 23.6176 28.4723 23.3598C28.2144 23.1019 27.8647 22.957 27.5 22.957H16.5C16.1353 22.957 15.7856 23.1019 15.5277 23.3598C15.2699 23.6176 15.125 23.9674 15.125 24.332C15.125 24.6967 15.2699 25.0464 15.5277 25.3043C15.7856 25.5622 16.1353 25.707 16.5 25.707H27.5C27.8647 25.707 28.2144 25.5622 28.4723 25.3043C28.7301 25.0464 28.875 24.6967 28.875 24.332ZM28.875 31.6654C28.875 31.3007 28.7301 30.951 28.4723 30.6931C28.2144 30.4352 27.8647 30.2904 27.5 30.2904H16.5C16.1353 30.2904 15.7856 30.4352 15.5277 30.6931C15.2699 30.951 15.125 31.3007 15.125 31.6654C15.125 32.03 15.2699 32.3798 15.5277 32.6376C15.7856 32.8955 16.1353 33.0404 16.5 33.0404H27.5C27.8647 33.0404 28.2144 32.8955 28.4723 32.6376C28.7301 32.3798 28.875 32.03 28.875 31.6654Z"
                                            fill="#6B7280" />
                                        <path fill-rule="evenodd" clip-rule="evenodd"
                                            d="M12.8307 4.625C11.4936 4.625 10.2112 5.15617 9.26573 6.10167C8.32024 7.04717 7.78906 8.32953 7.78906 9.66667V35.3333C7.78906 36.6705 8.32024 37.9528 9.26573 38.8983C10.2112 39.8438 11.4936 40.375 12.8307 40.375H31.1641C32.5012 40.375 33.7836 39.8438 34.7291 38.8983C35.6746 37.9528 36.2057 36.6705 36.2057 35.3333V15.108C36.2057 14.4095 35.9784 13.7312 35.5567 13.1738L30.0604 5.89917C29.7613 5.50338 29.3746 5.18233 28.9305 4.96125C28.4864 4.74016 27.9971 4.62507 27.5011 4.625H12.8307ZM10.5391 9.66667C10.5391 8.40167 11.5657 7.375 12.8307 7.375H26.1224V15.4362C26.1224 16.1952 26.7384 16.8112 27.4974 16.8112H33.4557V35.3333C33.4557 36.5983 32.4291 37.625 31.1641 37.625H12.8307C11.5657 37.625 10.5391 36.5983 10.5391 35.3333V9.66667Z"
                                            fill="#6B7280" />
                                    </svg>

                                </div>
                            </label>
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control ct_input_text ct_border_radius_30"
                                placeholder="Type your message..." [(ngModel)]="newMessage"
                                [ngModelOptions]="{standalone: true}" (keydown)="onKeyDown($event)">
                        </div>
                        <button class="ct_purple_btn ct_send_chat_btn"><i class="fa-solid fa-paper-plane me-2 "></i>
                            <span>Send</span></button>

                    </div>
                </div>

            </div>

        </div>
    </div>
</section> -->
@if(activeChatId){
<section class="message-area p-md-0">
    <div class="container-fluid">
        <div class="row">
            <div class="col-12 px-0">
                <div class="chat-area">
                    <!-- chatlist -->
                    <div class="chatlist">
                        <div class="modal-dialog-scrollable">
                            <div class="modal-content">
                                <div class="chat-header">
                                    <div class="msg-search">
                                        <input type="text" class="form-control" id="inlineFormInputGroup"
                                            placeholder="Search" aria-label="search" (input)="search($event)">
                                    </div>
                                </div>
                                <div class="modal-body mt-4">
                                    <!-- chat-list -->
                                    <div class="chat-lists">
                                        <div class="chat-list">
                                            @for (item of chatList; track $index) {
                                            <a class="d-flex align-items-center"
                                                [ngClass]="{ 'activeChat': item.id === activeChatId }"
                                                (click)="getAllmessages(item.id) ; show()">
                                                <div class="flex-shrink-0 position-relative">
                                                    <img class="img-fluid ct_img_w_50"
                                                        [src]="item.isGroupChat ? '' : item.participants[0].Author.avatar_url ? item.participants[0].Author.avatar_url : 'assets/img/profile_logo.jpg'"
                                                        alt="user img">
                                                    @if(item.participants[0].Author.isOnline){
                                                    <span class="active"></span>
                                                    }
                                                </div>
                                                <div class="flex-grow-1 ms-3">
                                                    <h3 class="ct_fs_16 ct_fw_600">
                                                        {{item.isGroupChat ? item.name :
                                                        item.participants[0].Author.fullName}}
                                                    </h3>
                                                    <p class="ct_fs_14 ct_purple_text">
                                                        {{ item.lastMessage?.content || 'No messages yet' }}
                                                    </p>
                                                </div>
                                                <div class="ct_caht_msg_notify">
                                                    <h4 class="ct_notify-time">
                                                        {{ formatDate(item.createdAt) }}
                                                    </h4>
                                                    @if(item.unreadCount > 0){
                                                    <span>{{item.unreadCount}}</span>
                                                    }
                                                </div>
                                            </a>
                                            }

                                            <!-- <a class="d-flex align-items-center">
                                                <div class="flex-shrink-0">
                                                    <img class="img-fluid ct_img_w_50"
                                                        [src]="newParticipant?.avatar_url ? newParticipant?.avatar_url : 'assets/img/np_pro.png'"
                                                        alt="user img">
                                                   @if(newParticipant.participants[0].Author.isOnline){
                                                        <span class="active"></span>
                                                        } 
                                                </div>
                                                <div class="flex-grow-1 ms-3">
                                                    <h3 class="ct_fs_16 ct_fw_600">
                                                        {{newParticipant?.fullName}}
                                                    </h3>
                                                    <p class="ct_fs_14 ct_purple_text">
                                                     {{item.lastMessage.content}} 
                                                    </p>
                                                </div>
                                                <div class="ct_caht_msg_notify">
                                                    <h4 class="ct_notify-time">
                                                        {{ formatDate(newParticipant?.createdAt) }}
                                                    </h4>
                                                   @if(item.unreadCount > 0){
                                                        <span>{{item.unreadCount}}</span>
                                                        } 
                                                </div>
                                            </a> -->

                                        </div>
                                    </div>
                                    <!-- chat-list -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- chatlist -->
                    <!-- chatbox -->
                    <div class="chatbox">
                        <div class="modal-dialog-scrollable">
                            <div class="modal-content">
                                <div class="msg-head">
                                    <h4 class="ct_fs_24 ct_fw_700 mb-3 text-capitalize">
                                        {{authorDetail?.fullName}}
                                    </h4>
                                    @if(authorDetail?.isOnline){
                                    <p class="mb-0 ct_fw_600 ct_text_898989">
                                        online</p>
                                    }
                                </div>
                                <!-- #scrollMe [scrollTop]="scrollMe.scrollHeight -->
                                <div class="modal-body" #scrollMe [scrollTop]=" scrollMe.scrollHeight">
                                    <div class="msg-body">
                                        <ul>
                                            @for (item of allMessages; track $index) {
                                            @if(item.senderAuthorId){
                                            <li style="max-width: fit-content;">
                                                <img [src]="item.isGroupChat ? '' : authorDetail?.avatar_url ? authorDetail?.avatar_url : 'assets/img/profile_logo.jpg'"
                                                    alt="">
                                                <div class="sender">
                                                    @if(item.ChatMessageFiles?.length > 0){
                                                    <div class="d-flex gap-2 flex-wrap">
                                                        <nz-image-group>
                                                            @for (file of item.ChatMessageFiles; track $index) {
                                                            <img nz-image [nzSrc]="file.fileName" class="img-fluid m-1">
                                                            }
                                                        </nz-image-group>
                                                    </div>
                                                    }
                                                    <p class="ct_fw_600 mb-2">
                                                        {{item.content}}
                                                    </p>
                                                    <span
                                                        class="time ms-auto d-block text-end">{{formatDate(item.createdAt)}}</span>
                                                </div>
                                            </li>
                                            }
                                            @if(item.senderUserId){
                                            <li style="width: fit-content;margin-left: auto;">
                                                <div class="repaly">
                                                    @if(item.ChatMessageFiles?.length > 0){
                                                    <div class="d-flex gap-2 flex-wrap">
                                                        <nz-image-group>
                                                            @for (file of item.ChatMessageFiles; track $index) {
                                                            <img nz-image [nzSrc]="file.fileName" class="img-fluid m-1">
                                                            }
                                                        </nz-image-group>
                                                    </div>
                                                    }
                                                    <p>{{item.content}}
                                                    </p>
                                                    <span class="time text-white">{{formatDate(item.createdAt)}}
                                                    </span>
                                                </div>
                                                <img [src]="userInfo.avatar_url ? userInfo.avatar_url : 'assets/img/profile_logo.jpg'"
                                                    alt="">
                                            </li>
                                            }
                                            }
                                        </ul>
                                    </div>
                                    <div *ngIf="previewFiles.length > 0" class="preview-container">
                                        <div *ngFor="let file of previewFiles" class="preview">
                                            <img *ngIf="file.type.startsWith('image/')" [src]="file.url"
                                                alt="File preview" />
                                            <i (click)="removeFile(file)" class="fa fa-minus-circle remove"
                                                aria-hidden="true"></i>
                                        </div>
                                    </div>
                                </div>

                                <div class="send-box px-0">
                                    <form action="" class="position-relative m-0">
                                        <label for="upload_chat_img_2" class="ct_upload_paper_click_img">
                                            <input type="file" accept="image/*" (change)="onFileChange($event)" multiple
                                                class="d-none" id="upload_chat_img_2">
                                            <div>
                                                <i class="fa-solid fa-paperclip"></i>
                                            </div>
                                        </label>
                                        <textarea type="text" class="form-control" aria-label="message…"
                                            placeholder="Write message…" [(ngModel)]="newMessage"
                                            [ngModelOptions]="{standalone: true}"
                                            (keydown)="onKeyDown($event)"></textarea>

                                        <div class="ct_right_side_send_chat_btns">
                                            <!-- <i class="fa-solid fa-microphone"></i> -->

                                            @if(uploading){
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                viewBox="0 0 24 24">
                                                <path fill="none" stroke="currentColor" stroke-dasharray="16"
                                                    stroke-dashoffset="16" stroke-linecap="round"
                                                    stroke-linejoin="round" stroke-width="2"
                                                    d="M12 3c4.97 0 9 4.03 9 9">
                                                    <animate fill="freeze" attributeName="stroke-dashoffset" dur="0.2s"
                                                        values="16;0" />
                                                    <animateTransform attributeName="transform" dur="1.5s"
                                                        repeatCount="indefinite" type="rotate"
                                                        values="0 12 12;360 12 12" />
                                                </path>
                                            </svg>
                                            } @else {
                                            <i class="fa fa-paper-plane ct_cursor_pointer" (click)="sendMessage()"></i>
                                            }
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- chatbox -->
            </div>
        </div>
    </div>
</section>
} @else {
<!-- when chat is empty then show below content -->
<div class="ct_empty_chat_box_content">
    <svg width="123" height="123" viewBox="0 0 123 123" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect x="0.956267" y="1.3696" width="120.87" height="120.87" rx="60.4348" fill="#F4F5FA" />
        <rect x="0.956267" y="1.3696" width="120.87" height="120.87" rx="60.4348" stroke="#E1E2E9"
            stroke-width="0.869565" />
        <path fill-rule="evenodd" clip-rule="evenodd"
            d="M76.764 77.1737C70.1202 83.8182 60.2823 85.2538 52.2315 81.5305C51.043 81.052 50.0686 80.6653 49.1423 80.6653C46.5621 80.6806 43.3505 83.1824 41.6814 81.5152C40.0122 79.8459 42.516 76.6318 42.516 74.036C42.516 73.1096 42.1446 72.1526 41.6661 70.9618C37.9411 62.9123 39.3787 53.0711 46.0225 46.4288C54.5036 37.9445 68.2828 37.9445 76.764 46.4266C85.2605 54.924 85.2452 68.6916 76.764 77.1737Z"
            fill="#BEC0CA" stroke="#8B8D97" stroke-width="1.30435" stroke-linecap="round" stroke-linejoin="round" />
        <path d="M69.9541 62.7022H69.9737" stroke="#8B8D97" stroke-width="1.73913" stroke-linecap="round"
            stroke-linejoin="round" />
        <path d="M61.2412 62.7022H61.2608" stroke="#8B8D97" stroke-width="1.73913" stroke-linecap="round"
            stroke-linejoin="round" />
        <path d="M52.5244 62.7022H52.544" stroke="#8B8D97" stroke-width="1.73913" stroke-linecap="round"
            stroke-linejoin="round" />
    </svg>
    <div>
        <h4 class="ct_fs_20 ct_fw_600">No Chats Found</h4>
        <!-- <p>Click on a contact to view messages.</p> -->
        <!-- <div class="">
                <a href="#" class="ct_purple_btn d-flex align-items-center gap-2"><svg
                        width="20" height="20" viewBox="0 0 20 20" fill="none"
                        xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd"
                            d="M15.8447 16.039C13.1871 18.6968 9.25198 19.271 6.03167 17.7817C5.55627 17.5903 5.16651 17.4356 4.79598 17.4356C3.7639 17.4417 2.47927 18.4425 1.81162 17.7756C1.14396 17.1079 2.14545 15.8222 2.14545 14.7839C2.14545 14.4133 1.99688 14.0305 1.8055 13.5542C0.315505 10.3344 0.890529 6.39795 3.54805 3.74101C6.94052 0.347298 12.4522 0.347298 15.8447 3.74014C19.2432 7.1391 19.2371 12.6461 15.8447 16.039Z"
                            stroke="white" stroke-width="1.30435" stroke-linecap="round"
                            stroke-linejoin="round" />
                        <path d="M13.1203 10.2505H13.1281" stroke="white"
                            stroke-width="1.73913" stroke-linecap="round"
                            stroke-linejoin="round" />
                        <path d="M9.63595 10.2505H9.64377" stroke="white"
                            stroke-width="1.73913" stroke-linecap="round"
                            stroke-linejoin="round" />
                        <path d="M6.14962 10.2505H6.15745" stroke="white"
                            stroke-width="1.73913" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                    <span> New Message</span></a>
            </div> -->
    </div>
</div>
}

<app-loader *ngIf="loading"></app-loader>